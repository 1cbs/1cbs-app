{% extends "base.html" %}

{% block title %}Video Library{% endblock %}

{% block content %}
<section class="card glass-effect" id="videos">
    <div class="card-header">
        <h2><i class="fas fa-video"></i> Video Library</h2>
        <!-- This now correctly checks if you are the master admin -->
        {% if session.get('is_master') %}
        <button class="btn-primary" onclick="openModal('addVideoModal')"><i class="fas fa-plus"></i> Add New Video</button>
        {% endif %}
    </div>
    <div class="card-content">
        <ul class="item-list">
            {% for v in videos %}
            <li>
                <span class="item-name"><i class="fas fa-film"></i> {{ v.title }}</span>
                <div class="item-actions">
                    <button class="btn-icon" onclick="openModal('videoPlayerModal', '{{ v.url }}')"><i class="fas fa-play"></i></button>
                    
                    <!-- This now correctly checks if ANY user is logged in -->
                    {% if 'user_id' in session %}
                    <form action="{{ url_for('create_watch_party') }}" method="POST" style="display: inline;">
                        <input type="hidden" name="video_selection" value="video-{{ v.id }}">
                        <button type="submit" class="btn-icon" title="Start a Watch Party"><i class="fas fa-users"></i></button>
                    </form>
                    {% endif %}

                    <!-- This now correctly checks if you are the master admin -->
                    {% if session.get('is_master') %}
                    <form action="{{ url_for('delete_video', id=v.id) }}" method="POST" style="display: inline;">
                        <button type="submit" class="btn-icon btn-delete"><i class="fas fa-trash"></i></button>
                    </form>
                    {% endif %}
                </div>
            </li>
            {% else %}
            <li>No videos added yet.</li>
            {% endfor %}
        </ul>
    </div>
</section>

<!-- Add Video Modal (Master Only) -->
{% if session.get('is_master') %}
<div id="addVideoModal" class="modal">
    <div class="modal-content glass-effect">
        <span class="close-btn" onclick="closeModal('addVideoModal')">&times;</span>
        <h2>Add New Video</h2>
        <form action="{{ url_for('add_video') }}" method="POST">
            <div class="form-group">
                <label for="video-title">Video Title</label>
                <input type="text" id="video-title" name="title" required>
            </div>
            <div class="form-group">
                <label for="video-url">Direct Video URL</label>
                <input type="url" id="video-url" name="url" placeholder="https://f005.backblazeb2.com/..." required>
            </div>
            <button type="submit" class="btn-primary">Save Video</button>
        </form>
    </div>
</div>
{% endif %}
{% endblock %}
